## 重构and单元测试 -- H3C

### 重构

书： 重构:改善既有代码的设计

《重构》书中提到的重构时机应该在添加功能、修复功能、审查代码时，不建议专门抽出时间专门做重构项目。

`重构（Refactoring）` 的常见定义是：不改变软件系统外部行为的前提下，改善它的内部结构。

https://dunwu.github.io/design/refactor/%E4%BB%A3%E7%A0%81%E7%9A%84%E5%9D%8F%E5%91%B3%E9%81%93%E5%92%8C%E9%87%8D%E6%9E%84.html#%E9%87%8D%E6%9E%84%E7%9A%84%E5%8E%9F%E5%88%99

### 测试分层

从底层到顶层：

单元测试 --> 集成测试 --> 自动化端到端测试（就是联调？！） --> 手工回归测试。



### 单元测试

https://jiakui.app/2019/08/22/unit-test/

优秀的代码需要有单元测试进行质量保证，每个测试用例都给应用的稳定性提供了一层保障。

先问我们自己以下几个问题：

- 你的代码质量如何度量？
- 你是如何保证代码质量？
- 你敢随时重构代码吗？
- 你是如何确保重构的代码依然保持正确性？
- 你是否有足够信心在没有测试的情况下随时发布你的代码？

如果答案都比较犹豫，那么就证明我们非常需要单元测试。

它能带给我们很多保障：

- 代码质量持续有保障
- 重构正确性保障
- 增强自信心
- 自动化运行

#### Mock

由于单元测试只是系统集成测试前的小模块测试，有些因素往往不具备的，因此需要进行Mock，例如：

1. 功能因素：比如被测试方法内部调用的功能不可用。
2. 时间因素：比如双十一还没有到来，与此时间相关的功能点。
3. 环境因素：政策环境，如支付宝政策累新功能；多端环境，如PC、手机等。
4. 数据因素：线下因素数据样本过小，难以覆盖线上真实场景。
5. 其他因素：为了简化测试编写，开发者可以将一些复杂的依赖采用Mock的方式实现。

#### 断言库

同样，测试断言库也是百花齐放的时代， 我们经历过 [assert](https://nodejs.org/api/assert.html)，到 [should](https://github.com/shouldjs/should.js) 和 [expect](https://github.com/Automattic/expect.js)，还是不断地在尝试更好的断言库。

直到我们发现 [power-assert](https://github.com/power-assert-js/power-assert)， 因为[『No API is the best API』](https://github.com/atian25/blog/issues/16)， 最终我们重新回归原始的 assert 作为默认的断言库。

简单地说，它的优点是：

- 没有 API 就是最好的 API，不需要任何记忆，只需 assert 即可。
- **强大的错误信息反馈**
- **强大的错误信息反馈**
- **强大的错误信息反馈**

报错信息实在太美太详细，让人有种想看错误报告的欲望

#### 接口说明

需要记录：

* 接口方法： post、put、get
* 接口路径： /service
* 接口参数：json、key-value
* 接口返回：正常和异常返回

#### mock

egg js 库 等工具

https://eggjs.org/zh-cn/core/unittest.html#mock-%E6%96%B9%E6%B3%95

### 开源项目：单测case

