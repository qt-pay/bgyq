## 单播 and 广播 and 组播

### 网络拓扑

![](https://image-1300760561.cos.ap-beijing.myqcloud.com/bgyq-blog/net-topo.png)

用户主机使用不同的类别的IP地址，就选用了不同的传输方式：

- IP报文网络传输使用单播IP地址的，简称为单播。
- IP报文网络传输使用广播IP地址的，简称为广播。
- IP报文网络传输使用组播IP地址的，简称为组播。



### 单播

单播是主机间一对一的通讯模式，网络中的设备根据网络报文中包含的目的地址选择传输路径，将单播报文传送到指定的目的地，只对接收到的数据进行转发，不会进行复制。它能够针对每台主机及时的响应，现在的网页浏览全部都是采用单播模式。

#### 单播地址

单播IP地址：一个单播IP地址只能标识一台用户主机。一份使用单播IP地址为目的地址的IP报文，只能被一台用户主机接收

#### 单播流量图

采用单播传输方式后，要确保有流量需求的用户都能收到流量，数据源需要发送三份流量，相应的网络中设备B也需要承载三份流量。

![](https://image-1300760561.cos.ap-beijing.myqcloud.com/bgyq-blog/net-topo-Unicast.png)



### 广播

广播是主机间一对所有的通讯模式，设备会将报文发送到网络中的所有可能接收者。设备简单地将它收到的任何广播报文都复制并转发到除该报文到达的接口外的每个接口。广播处理流程简单，不用选择路径。

#### 广播地址

一个广播IP地址能够标识某确定网段内的所有用户主机。一份使用广播IP地址为目的地址的IP报文，能够被该网段内的所有用户主机接收。IP广播报文不能跨网段传播。

#### 广播流量图

![](https://image-1300760561.cos.ap-beijing.myqcloud.com/bgyq-blog/net-topo-broadcast.png)



### 组播

组播是主机间一对多的通讯模式， 组播是一种允许一个或多个组播源发送同一报文到多个接收者的技术。组播源将一份报文发送到特定的组播地址，组播地址不同于单播地址，它并不属于特定某个主机，而是属于一组主机。一个组播地址表示一个群组，需要接收组播报文的接收者都加入这个群组。

#### 产生背景

传统的IP通信有两种方式：一种是在源主机与目的主机之间点对点的通信，即单播；另一种是在源主机与同一网段中所有其它主机之间点对多点的通信，即广播。如果要将信息发送给多个主机而非所有主机，若采用广播方式实现，不仅会将信息发送给不需要的主机而浪费带宽，也不能实现跨网段发送；若采用单播方式实现，重复的IP包不仅会占用大量带宽，也会增加源主机的负载。所以，传统的单播和广播通信方式不能有效地解决单点发送、多点接收的问题。

#### 组播地址

一个组播IP地址能够标识网络不同位置的多个用户主机，一台用户主机可以同时识别多个组播IP地址。一份使用组播IP地址为目的地址的IP报文，能够被网络不同位置的多个用户主机接收。

IP组播地址用于标识一个IP组播组。IANA把D类地址空间分配给组播使用，范围从224.0.0.0到239.255.255.255。

* 224.0.0.0到224.0.0.255被IANA预留，地址224.0.0.0保留不做分配，其它地址供路由协议及拓扑查找和维护协议使用。该范围内的地址属于局部范畴，不论TTL为多少，都不会被路由器转发；
* 224.0.1.0到238.255.255.255为用户可用的组播地址，在全网范围内有效。其中232.0.0.0/8为SSM组地址，而其余则属于ASM组地址。、
*  239.0.0.0到239.255.255.255为本地管理组播地址，仅在特定的本地范围内有效，也属于ASM组地址。使用本地管理组地址可以灵活定义组播域的范围，以实现不同组播域之间的地址隔离，从而有助于在不同组播域内重复使用相同组播地址而不会引起冲突。

IP组播地址前四位均为“1110”，而整个IP组播地址空间的划分则如图所示。

![](https://image-1300760561.cos.ap-beijing.myqcloud.com/bgyq-blog/multicast-ip-addr.gif)



#### 组播流量

![](https://image-1300760561.cos.ap-beijing.myqcloud.com/bgyq-blog/net-topo-multicast.png)

#### 组播实现

https://support.huawei.com/enterprise/zh/doc/EDOC1100105907

组播组网实现用户A，用户B和用户C能接收到数据源的流量，需要做如下部署：

- 全网设备相连的接口都需要配置单播IP地址
- 全网要部署单播路由协议，确保数据源和用户A、用户B和用户C之间路由互通
- 全网部署组播PIM协议（PIM-SM或者PIM-DM），并配置相应的BSR和RP，图中配置设备B为RP和BSR。
- 用户A，用户B，用户C必须发送IGMP组加入报文，组加入报文中包含其需要加入的组IP地址225.1.1.1。

数据源发送数据流，该数据流二层目的MAC地址是组播的MAC地址，IP报文的目的地址为225.1.1.1。

![](https://image-1300760561.cos.ap-beijing.myqcloud.com/bgyq-blog/multicast-mechanism.png)



组播实现机制总体来说就是接收者告诉一个中心节点（在组播协议里面称为RP），它需要哪些组地址的流量；RP需要被告之数据源（在组播场景中我们称之为组播源，它的特点是流量二层头中目的MAC地址是组播MAC地址，IP报层IP报文头目的地址是组播IP地址）在哪，数据源往哪些组地址发流。RP知道了接收方和发送方的所有信息后，就会根据需要把流量发送到特定位置（它发送的过程中建立了组播分发树）



