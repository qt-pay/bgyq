### BGP线路与EIP

### EIP：BGP (Multi-ISP) 

The Elastic IP (EIP) service enables your cloud resources to communicate with the Internet using static public IP addresses and scalable bandwidths. EIPs can be bound to or unbound from ECSs, BMSs, virtual IP addresses, NAT gateways, or load balancers.

EIP是一个公网IP，一个公网IP必然要依赖一个运营商的链路去传播数据。EIP依赖单线运营商链路就会出现单点问题，所以要依赖BGP Multi-ISP、

BGP (Multi-ISP) Pro lines optimize data transmission to the Chinese mainland and improve connection quality for international services. Compared with BGP (Multi-ISP) lines, when BGP (Multi-ISP) Pro lines provide services to users in the Chinese mainland (excluding data centers), cross-border connections are established by using Chinese mainland ISP services. T

#### 单线

**通常指电信单线路或联通单线路或移动单线路（单网卡单IP）。**

单线服务器就是指这个IDC机房要么是联通线路接入，要么是电信线路接入，要么就是移动线路接入，相互之间跨运营商访问效果比较差。

**单线优势就是大带宽成本低，机房出口带宽充足。**

#### 双线

**通常就是电信+联通双线路(单网卡双IP或双网卡双IP)。**

双线服务器是指这个机房是由电信、联通两条线路同时接入的。

这样服务器就拥有了两个IP地址，然后利用路由器技术自动分辨访问者的线路，从而实现电信用户使用电信IP进网站，网通用户使用网通IP访问网站，这是单网卡双IP方式。这样做可以从硬件上解决两种线路互访困难的情况，以此提高网站打开速度。

**但如何实现一个域名电信用户访问电信IP? 网通用户访问网通IP地址呢?**

**域名智能DNS解析双线主机实现，域名泛解析或者对应线路智能解析**。

#### 多线

**通常是电信+联通+移动(单网卡三IP)，公网分别通过电信、联通、移动的IP地址对接入电信、联通、移动上层运营商公网。**原理跟双线单网卡双IP差不多。



#### BGP线路： N个运行商共享一个出口带宽

**3线3IP和3线单IP的区别在于网卡，3IP需要3个网卡来区别每条线路，3线单IP就是BGP线路**

各种机房都宣称是BGP线路没错，比如你租用了100M带宽，这里面有80M电信+10M联通+10M移动，而你的网站用户的比例是40%电信+40%移动+20%联通，那高峰期是不是就会出现100M带宽并没满(因为电信带宽绰绰有余)，但是移动用户已经卡死了。其实这就和共享带宽一样的道理，机房总的移动带宽不够，但所有客户都想要，那结果就是卡。通常这种问题解决得好的机房也是大机房，**同理，价格也贵**

### BGP线路类型

| 对比维度   | 静态BGP                                                      | 全动态BGP                                                    | 优选BGP                                                      |
| ---------- | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 定义       | 由网络运营商手动配置的路由信息。当网络的拓扑结构或链路的状态发生变化时，运营商需要手动去修改路由表中相关的静态路由信息。 | 使用BGP协议同时接入多个运营商，可以根据设定的寻路协议实时自动优化网络结构，保持客户使用的网络持续稳定，高效。 | 优选BGP是特定方向的优质线路。使用BGP协议与多家主流运营商线路互联对接，建立直连中国内地的公网互联路径，提供中国-香港区域与中国内地间的低时延、高质量的网络互通。 |
| 保障性     | 当静态BGP中网络结构发生变化，运营商是无法在第一时间自动调整网络设置，而是通过其他技术进行切换，所以静态BGP时延一般略大。**说明：**如用户选择静态BGP，需要自身应用系统具备容灾功能。 | 多线接入的BGP，能够感知接入线路及运营商内部网络状况，运营商内部故障时，能够快速切换到其他运营商接入链路，保证用户能够正常访问，而不是访问中断。目前支持的运营商线路包括：电信、移动、联通、教育网、广电、鹏博士等 。 | 线路保障能力与全动态BGP一致，多线接入的BGP，在遇到运营商内部故障时，能够快速切换到其他运营商接入链路，保证用户能够正常访问。除此之外，质量更高，时延更低。 |
| 服务可用性 | 99%                                                          | 99.95%                                                       | 99.95%                                                       |

### BGP机房

BGP是指边界网关协议（Border Gateway Protocol），BGP是运行于TCP上的一种自治系统（AS）的路由协议，是能够妥善处理不相关路由域间的多路连接的协议。BGP协议主要用于互联网AS（自治系统）之间的互联。

举个通俗的例子：

电信、联通等其他的大型IDC运营商都拥有自己的AS自治域号，不同运营商线路之间访问速度比较慢，比如：托管在电信机房的服务器，联通用户访问速度比较慢；如果服务器是BPG线路，无论用户使用电信、联通、移动或者其他线路，都可以无故障且快速的访问服务器；BGP能够控制路由的传播和选择最优的路由。

BGP不仅能够解决速度问题，还可以解决绕过线路故障，如下图所示：

![](https://image-1300760561.cos.ap-beijing.myqcloud.com/bgyq-blog/bgp-multi-ISP.jpeg)

- 服务器只需要设置一个IP地址，最佳访问路由是由网络上的骨干路由器根据路由跳数与其它技术指标来确定的，不会占用服务器的任何系统资源。服务器的上行路由与下行路由都能选择最优的路径，所以能真正实现高速的单IP高速访问。
- 由于BGP协议本身具有冗余备份、消除环路的特点，所以当IDC服务商有多条BGP互联线路时可以实现路由的相互备份，在一条线路出现故障时路由会自动切换到其它线路。
- 使用BGP协议还可以使网络具有很强的扩展性可以将IDC网络与其他运营商互联，轻松实现单IP多线路，做到所有互联运营商的用户访问都很快。这个是双IP双线无法比拟的。

但是BGP线路造价贵，而且带宽不充足，因为移动、联调和电信三个运行商共享一个100M带宽，那么移动的client过来肯定分不到100M的带宽，和单线移动的带宽体验差太多了。

**如果业务是服务全国用户或者当地电信联通市场占比各半，流量在百兆以内就放在BGP多线，速度快，服务器有保障。**